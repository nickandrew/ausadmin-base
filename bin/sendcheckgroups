#!/bin/bash
#	@(#) bin/sendcheckgroup - Create/post newsgroup list and checkgroups
#
# $Source$
# $Revision$
# $Date$

bin/gengrouplist.pl > tmp/grouplist.$$
s=$?
if [ $s -ne 0 ] ; then
	echo "bin/gengrouplist.pl returned status $s - fatal"
	rm -f tmp/grouplist.$$
	exit 2
fi

bin/gencheckgroups.pl > tmp/checkgroups.$$
s=$?
if [ $s -ne 0 ] ; then
	echo "bin/gencheckgroups.pl returned status $s - fatal"
	rm -f tmp/checkgroups.$$
	exit 3
fi

# Replace the current version with the latest

mv tmp/grouplist.$$ data/grouplist.msg
mv tmp/checkgroups.$$ data/checkgroups.msg

#----------------------------------------------------------------------------
#  Post the messages
#----------------------------------------------------------------------------

rc=0
bin/post.pl < data/grouplist.msg
s=$?
if [ $s -ne 0 ] ; then
	echo "post.pl submission of data/grouplist.msg returned status $s"
	rc=2
fi

bin/post.pl < data/checkgroups.msg
s=$?
if [ $s -ne 0 ] ; then
	echo "post.pl submission of data/grouplist.msg returned status $s"
	rc=4
fi

exit $rc
